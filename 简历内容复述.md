##
## RPC
1. 定义接口
2. 配置领域名、重试次数、超时时间（注解）
3. 游戏启服扫描构建动态代理
4. 动态代理调用网络传输，回调采用率自增id记录

## 服务化
#### 注册中心
采用适配器的形式，现在使用的时nacos
原因：动态刷新使用netty进行TCP连接即可、支持组、临时实例：服务实例定时向注册中心发送心跳，注册中心如果没收到，则判断为不健康状态，延迟一段时间后移除
订阅客户端拉取数据：定时拉取，使用md5比对，如果没有变化，则30s后发送数据，期间有任何变化则立即发送，如果变化，立即发送
### 优雅上线
先数据初始化好再注册服务
服务实例权重慢慢增加
### 优雅下线
服务实例关闭前设定关闭标志，不接受任何数据
消费队列里的所有任务消费完后，关闭服务
服务关闭超时时间：10秒
### 服务熔断
如果存在大量的超时处理，就会熔断接口
### 负载均衡
权重去除+玩家人数排序
## 领域化
#### 线程模型
单进程多线程，actor会根据id取mod进到同一个线程，会有多个线程池，如玩家线程池
#### 模块
领域模块采用组件的形式组合，协议事件接收、业务和数据都在组件内，开发方便
#### 生命周期
定义了初始化和销毁方法，定义了优先级避免模块相互依赖
#### 持久化
会把组件key（类型）：数据（json序列后的模块数据）通过字典的方法持久化到数据库，模块数据修改后会把key值记录到待持久化列表，持久化器通过心跳的形式持久化。持久化器时单独的线程
#### actor交互
rpc，获取同步数据
## 主从同步
主从同步的作用是用于actor的数据会同步多个附属actor，如玩家数据会同步到玩家服和世界服，类似远程存了镜像数据
## 事件机制
起服扫描组件关注的事件类，记录到对应的actor类型，事件抛出时会根据类型获取actor
## 组织框架（行会、队伍）
组织-》map保存成员数据
成员
1. id
2. 角色
3. 其他数据
角色
	包含操作
权限
	邀请、任命、管理等
操作
	任命、角色修改、移除与添加成员
## mongo
服务区分
1. 配置中心-》分片配置
2. 查询路由-》操作片查询
3. 数据分片-》范围分片
chunk（主从复制）
集群，采用raft算法进行选举与日志同步
主节点负责写和读
## 视野
十字链表
-》十字链表结构
-》标记物快速找到位置，避免遍历
-》单位哨兵
## 移动做法
逻辑帧（tick）：15毫秒
移动队列：存储移动数据
### 客户端需做
1. 移动平滑：就是把一次逻辑移动放在随后的一个逻辑帧时间内平滑渲染出来。比如说玩家在第n个逻辑帧进行移动（从a到b点），那么渲染帧就让人物从此开始逐渐从a到b点平滑运动，刚好第n+1个逻辑帧运行到b点。而刚好此时可能会产生下一次移动（到c点）
2. 滞后时间（第三方客户端加大延迟）
滞后时间 = 1/F + A到S最大网络延迟 + S到B最大网络延迟
### 服务器需做
1. 滞后补偿
滞后补偿系统记录前1s内所有玩家的位置。如果一个玩家指令被执行，服务器将会用下面的公式来估算指令的生成时间
==指令执行时刻（客户端生成指令的时刻） = 当前服务器时刻 - 数据包传输延迟 - 逻辑帧时间 #EE3F4D==
然后，服务器将所有其他玩家（只有玩家）移回到指令执行时刻的位置。这样玩家的指令在执行的时候就可以正确瞄准了。在用户指令被处理完成后，玩家恢复到当前时刻的位置